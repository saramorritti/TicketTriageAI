@page
@model TicketTriageAI.Dashboard.Pages.Tickets.IndexModel
@using TicketTriageAI.Core.Models

<h1>Tickets</h1>

<form method="get" style="margin-bottom:16px;">
    <input type="text" name="q" value="@Model.Q" placeholder="search subject/from" />
    <select name="status">
        <option value="">-- status --</option>
        @foreach (var s in Enum.GetValues<TicketStatus>())
        {
            <option value="@s" selected="@(Model.Status == s)">@s</option>
        }
    </select>
    <button type="submit">Search</button>
</form>

<table class="table">
    <thead>
        <tr>
            <th>Received</th>
            <th>From</th>
            <th>Subject</th>
            <th>Cat</th>
            <th>Sev</th>
            <th>Conf</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var t in Model.Items)
        {
            <tr>
                <td>@t.ReceivedAt</td>
                <td>@t.From</td>
                <td>
                    <a href="/Tickets/Detail?messageId=@t.MessageId">@t.Subject</a>
                </td>
                <td>@t.Category</td>
                <td>@t.Severity</td>
                <td>@t.Confidence</td>
                <td>@t.Status (@t.StatusReason)</td>
            </tr>
        }
    </tbody>
</table>
@if (!string.IsNullOrWhiteSpace(Model.NextContinuationToken))
{
    <a asp-page="./Index"
       asp-route-q="@Model.Q"
       asp-route-status="@Model.Status"
       asp-route-continuationToken="@Model.NextContinuationToken">
        Next →
    </a>
}

